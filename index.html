// no seu <script> em index.html
async function gerarQr(price, title) {
  try {
    const res = await fetch(
      `/.netlify/functions/generateQr?price=${price}&title=${encodeURIComponent(title)}`
    );
    const json = await res.json();
    if (!res.ok) throw new Error(json.error || "Erro desconhecido");
    return json; // { qr_code, qr_base64, init_point }
  } catch (err) {
    throw err;
  }
}

document.querySelectorAll(".buy-button").forEach(btn => {
  btn.addEventListener("click", async () => {
    const price = btn.dataset.price;
    const title = btn.dataset.title;
    try {
      const { qr_base64 } = await gerarQr(price, title);
      document.getElementById("qrImage").src = `data:image/png;base64,${qr_base64}`;
      document.getElementById("success").textContent = "";
    } catch (e) {
      document.getElementById("success").textContent = `Erro ao gerar QR: ${e.message}`;
    }
  });
});
