<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Encantos da Lis â€“ Loja</title>
  <style>
    /* SÃ³ exemplo simplificado */
    .products { display: flex; gap: 1rem; flex-wrap: wrap; }
    .product { border: 1px solid #ccc; padding: 1rem; width: 200px; }
    .product img { width: 100%; }
    .buy-button { display:block; margin-top:0.5rem; padding:0.5rem; background:#28a; color:#fff; text-align:center; cursor:pointer; }
    #overlay { position: fixed; inset:0; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; }
    .modal { background:#fff; padding:1rem; border-radius:4px; width:300px; }
    .tabs { display:flex; gap:1rem; margin-bottom:1rem; }
    .tabs button { flex:1; padding:0.5rem; cursor:pointer; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    #qrContainer img { width:100%; }
  </style>
</head>
<body>
  <h1>Encantos da Lis â€“ Colete Country</h1>
  <div class="products">
    <!-- 5 produtos -->
    <template id="tpl-product">
      <div class="product">
        <img src="" alt="">
        <div><strong class="name"></strong><br><em>Material: Feltro</em></div>
        <div>Valor: R$ <span class="price"></span></div>
        <div class="buy-button">Comprar</div>
      </div>
    </template>
  </div>

  <!-- Modal -->
  <div id="overlay">
    <div class="modal">
      <div class="tabs">
        <button data-tab="payment">Pagamento</button>
        <button data-tab="form">Dados</button>
      </div>
      <div id="payment" class="tab-content active">
        <div id="qrContainer">Gerando QRâ€¦</div>
        <div id="success" style="display:none;">ðŸŽ‰ Pagamento concluÃ­do!</div>
      </div>
      <div id="form" class="tab-content">
        <label>Nome<input type="text" id="nome"></label><br>
        <label>EndereÃ§o<textarea id="endereco"></textarea></label><br>
        <label>NÃºmero<input type="text" id="numero"></label><br>
        <label>Cidade<input type="text" id="cidade"></label><br>
        <label>Bairro<input type="text" id="bairro"></label><br>
        <label>Ponto de Ref<input type="text" id="ref"></label><br>
        <label>WhatsApp<input type="text" id="whatsapp"></label><br>
        <button id="finalizar">Enviar para WhatsApp</button>
      </div>
      <button id="close">Fechar</button>
    </div>
  </div>

  <script>
    // produtos e preÃ§os
    const produtos = [
      { id:1, name:'Colete Country', price:25, img:'imagem1.jpg' },
      { id:2, name:'Colete Country', price:30, img:'imagem2.jpg' },
      { id:3, name:'Colete Country', price:37, img:'imagem3.jpg' },
      { id:4, name:'Colete Country', price:20, img:'imagem4.jpg' },
      { id:5, name:'Colete Country', price:30, img:'imagem5.jpg' },
    ];

    const tpl = document.getElementById('tpl-product');
    const container = document.querySelector('.products');

    produtos.forEach(p=>{
      const clone = tpl.content.cloneNode(true);
      clone.querySelector('img').src = p.img;
      clone.querySelector('img').alt = `${p.name} R$${p.price}`;
      clone.querySelector('.name').textContent = p.name;
      clone.querySelector('.price').textContent = p.price.toFixed(2);
      const btn = clone.querySelector('.buy-button');
      btn.addEventListener('click', ()=>openModal(p));
      container.appendChild(clone);
    });

    // modal e abas
    const overlay = document.getElementById('overlay');
    const tabs = document.querySelectorAll('.tabs button');
    tabs.forEach(b=>{
      b.onclick = ()=>{
        tabs.forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        document.getElementById(b.dataset.tab).classList.add('active');
      }
    });
    document.getElementById('close').onclick = ()=> overlay.style.display='none';

    let selectedProduct = null;
    async function openModal(prod) {
      selectedProduct = prod;
      overlay.style.display = 'flex';
      document.querySelector('[data-tab="payment"]').click();

      // gera QR chamando sua Function Netlify
      const res = await fetch(`/.netlify/functions/generateQr?amount=${prod.price}`);
      const { qrcode } = await res.json();
      document.getElementById('qrContainer').innerHTML = `<img src="${qrcode}" alt="QR de R$${prod.price}"/>`;
      
      // aguarda confirmaÃ§Ã£o simulada: aqui vocÃª detecta via webhook ou polling
      // para demo, vamos simular 3s depois:
      document.getElementById('success').style.display='none';
      setTimeout(()=>{
        document.getElementById('success').style.display='block';
        document.querySelector('[data-tab="form"]').click();
      }, 3000);
    }

    // ao enviar pedido
    document.getElementById('finalizar').onclick = ()=>{
      let msg = `ðŸ“¦ Pedido â€“ ${selectedProduct.name}\nR$${selectedProduct.price.toFixed(2)}\n`;
      msg += `Nome: ${nome.value}\nEndereÃ§o: ${endereco.value}, nÂº ${numero.value}\n`;
      msg += `Cidade: ${cidade.value}\nBairro: ${bairro.value}\nRef: ${ref.value}\n`;
      msg += `WhatsApp: ${whatsapp.value}`;

      const waUrl = `https://wa.me/5531987961356?text=${encodeURIComponent(msg)}`;
      window.open(waUrl, '_blank');
      overlay.style.display='none';
    };
  </script>
</body>
</html>
